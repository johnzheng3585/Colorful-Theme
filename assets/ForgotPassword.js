import{u as V,r as v,a as q,k as C,c as E,b as a,t as o,e as r,w as i,f,h as R,o as b,l as z,m as B,i as y,j as m}from"./index.js";import{g as I,s as N,f as T}from"./auth.js";import{_ as U}from"./_plugin-vue_export-helper.js";const A={class:"dark-tech-auth"},j={class:"auth-grid"},D={class:"branding-side"},M={class:"brand-content"},G={class:"logo-container"},L={class:"brand-title"},H={class:"brand-desc"},J={class:"features"},K={class:"feature-badge"},O={class:"feature-badge"},Q={class:"form-side"},W={class:"glass-card form-container"},X={class:"form-header"},Y={class:"code-input-group"},Z={class:"form-footer"},x={href:"#/login",class:"link-primary"},ee={__name:"ForgotPassword",setup(ae){const{t:n}=V(),$=R(),_=v(!1),d=v({}),t=q({email:"",password:"",re_password:"",email_code:""}),u=v(0);let h=null;const P=async()=>{if(!t.email)return m.error(n("validation.emailRequired"));try{await N({email:t.email}),m.success(n("auth.codeSent")),u.value=60,h=setInterval(()=>{u.value--,u.value<=0&&clearInterval(h)},1e3)}catch(e){m.error(e.message||n("auth.sendFailed"))}};C(async()=>{try{const e=await I();e.data&&(d.value=e.data)}catch(e){console.error("Failed to fetch config:",e)}});const k=async(e,s)=>{if(!s)throw new Error("è¯·è¾“å…¥é‚®ç®±");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))throw new Error("è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€");if(d.value.email_whitelist_suffix&&Array.isArray(d.value.email_whitelist_suffix)){const c=s.split("@")[1];if(!d.value.email_whitelist_suffix.includes(c))throw new Error(`ä»…æ”¯æŒä»¥ä¸‹é‚®ç®±åŽç¼€: ${d.value.email_whitelist_suffix.join(", ")}`)}},F=async e=>{if(e.password!==e.re_password)return m.error(n("validation.passwordMismatch"));_.value=!0;try{(await T(e)).data&&(m.success(n("auth.resetPasswordSuccess")),$.push("/login"))}catch(s){m.error(s.message||n("auth.resetPasswordFailed"))}finally{_.value=!1}};return(e,s)=>{const p=f("a-input"),c=f("a-form-item"),w=f("a-button"),g=f("a-input-password"),S=f("a-form");return b(),E("div",A,[a("div",j,[a("div",D,[a("div",M,[a("div",G,[s[4]||(s[4]=a("div",{class:"logo-glow"},null,-1)),a("h1",L,o(e.$t("auth.forgotPasswordTitle")),1)]),a("p",H,o(e.$t("auth.brandDesc")),1),a("div",J,[a("div",K,[s[5]||(s[5]=a("div",{class:"badge-icon"},"ðŸ”’",-1)),a("span",null,o(e.$t("auth.secureVerification")),1)]),a("div",O,[s[6]||(s[6]=a("div",{class:"badge-icon"},"ðŸ“§",-1)),a("span",null,o(e.$t("auth.emailVerification")),1)])])])]),a("div",Q,[a("div",W,[a("div",X,[a("h2",null,o(e.$t("auth.forgotPasswordTitle")),1),a("p",null,o(e.$t("auth.forgotPasswordSubtitle")),1)]),r(S,{model:t,onFinish:F,layout:"vertical"},{default:i(()=>[r(c,{label:e.$t("auth.email"),name:"email",rules:[{validator:k}]},{default:i(()=>[r(p,{value:t.email,"onUpdate:value":s[0]||(s[0]=l=>t.email=l),placeholder:"your@email.com",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),d.value.is_email_verify?(b(),z(c,{key:0,label:"é‚®ç®±éªŒè¯ç ",name:"email_code",rules:[{required:!0,message:"è¯·è¾“å…¥é‚®ç®±éªŒè¯ç "}],class:"code-item"},{default:i(()=>[a("div",Y,[r(p,{value:t.email_code,"onUpdate:value":s[1]||(s[1]=l=>t.email_code=l),placeholder:"è¾“å…¥éªŒè¯ç ",size:"large"},null,8,["value"]),r(w,{type:"primary",class:"send-code-btn",disabled:u.value>0||!t.email,onClick:P},{default:i(()=>[y(o(u.value>0?`${u.value}s`:"å‘é€éªŒè¯ç "),1)]),_:1},8,["disabled"])])]),_:1})):B("",!0),r(c,{label:e.$t("auth.newPassword"),name:"password",rules:[{required:!0,message:e.$t("validation.passwordRequired")},{min:6,message:"å¯†ç è‡³å°‘6ä½"}]},{default:i(()=>[r(g,{value:t.password,"onUpdate:value":s[2]||(s[2]=l=>t.password=l),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),r(c,{label:e.$t("auth.confirmPassword"),name:"re_password",rules:[{required:!0,message:e.$t("validation.passwordRequired")}]},{default:i(()=>[r(g,{value:t.re_password,"onUpdate:value":s[3]||(s[3]=l=>t.re_password=l),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),r(w,{type:"primary","html-type":"submit",loading:_.value,block:"",size:"large"},{default:i(()=>[y(o(e.$t("auth.resetPassword")),1)]),_:1},8,["loading"])]),_:1},8,["model"]),a("div",Z,[a("span",null,o(e.$t("auth.hasAccount")),1),a("a",x,o(e.$t("auth.backToLogin")),1)])])])])])}}},re=U(ee,[["__scopeId","data-v-5cf5cb03"]]);export{re as default};
