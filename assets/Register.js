import{u as x,r as b,a as z,o as T,c as k,b as t,d as _,g as F,t as i,e as r,w as u,f as g,h as J,i as v,j as N,k as R,l as S,m}from"./index.js";import{g as O,s as j,r as L,l as M}from"./auth.js";import{g as D,a as G,b as H}from"./user.js";import{C as K}from"./Captcha.js";import{_ as Q}from"./_plugin-vue_export-helper.js";const W={class:"dark-tech-auth"},X={class:"auth-grid"},Y={class:"branding-side"},Z={class:"brand-content"},ee={class:"logo-container"},ae=["src","alt"],te={key:1,class:"brand-title"},se={class:"brand-desc"},oe={class:"features"},re={class:"feature-badge"},le={class:"feature-badge"},ie={class:"form-side"},ne={class:"glass-card form-container"},de={class:"form-header"},ue={class:"code-input-group"},ce={class:"form-footer"},me={href:"#/login",class:"link-primary"},fe={__name:"Register",setup(pe){const{t:n}=x(),f=F(),C=J(),y=b(!1),p=b({}),w=b(null),E=e=>{w.value=e},s=z({email:"",password:"",re_password:"",email_code:"",agreement:!0}),h=b(0);let $=null;const U=async()=>{if(!s.email)return m.error(n("validation.emailRequired"));if(f.enableCaptcha&&w.value!==!0)return m.error(n("auth.enterCaptcha"));try{await j({email:s.email}),m.success(n("auth.codeSent")),h.value=60,$=setInterval(()=>{h.value--,h.value<=0&&clearInterval($)},1e3)}catch(e){m.error(e.message||n("auth.sendFailed"))}};T(async()=>{try{const e=await O();e.data&&(p.value=e.data)}catch(e){console.error("Failed to fetch config:",e)}});const V=async(e,a)=>{if(!a)throw new Error("è¯·æŽ¥å—æœåŠ¡æ¡æ¬¾")},q=async(e,a)=>{if(!a)throw new Error("è¯·è¾“å…¥é‚®ç®±");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))throw new Error(n("validation.emailInvalid"));if(p.value.email_whitelist_suffix&&Array.isArray(p.value.email_whitelist_suffix)){const l=a.split("@")[1];if(!p.value.email_whitelist_suffix.includes(l))throw new Error(n("validation.emailSuffixNotAllowed",{suffixes:p.value.email_whitelist_suffix.join(", ")}))}},A=async e=>{if(f.enableCaptcha){if(w.value===null)return m.error(n("auth.enterCaptcha"));if(w.value===!1)return m.error(n("auth.captchaInvalid"))}if(e.password!==e.re_password)return m.error(n("validation.passwordMismatch"));y.value=!0;try{if((await L(e)).data){m.success(n("auth.registerSuccess"));try{const c=await M({email:e.email,password:e.password});if(c.data){localStorage.setItem("auth_token",c.data.auth_data);try{const l=[D().then(o=>o.data&&localStorage.setItem("xboard_user_info",JSON.stringify(o.data))),G().then(o=>o.data&&localStorage.setItem("xboard_subscribe_info",JSON.stringify(o.data))),H().then(o=>o.data&&localStorage.setItem("xboard_notices",JSON.stringify(o.data)))];await Promise.race([Promise.allSettled(l),new Promise(o=>setTimeout(o,800))])}catch(l){console.error("Registration pre-fetch failed:",l)}C.push("/");return}}catch(c){console.error("Auto-login failed after registration:",c),C.push("/login")}}}catch{}finally{y.value=!1}};return(e,a)=>{const c=g("a-input"),l=g("a-form-item"),o=g("a-button"),I=g("a-input-password"),B=g("a-checkbox"),P=g("a-form");return v(),k("div",W,[t("div",X,[t("div",Y,[t("div",Z,[t("div",ee,[a[5]||(a[5]=t("div",{class:"logo-glow"},null,-1)),_(f).logoUrl?(v(),k("img",{key:0,src:_(f).logoUrl,alt:_(f).siteName,class:"brand-logo-image"},null,8,ae)):(v(),k("h1",te,"åŠ å…¥ "+i(_(f).siteName),1))]),t("p",se,i(e.$t("auth.registerSubtitle")),1),t("div",oe,[t("div",re,[a[6]||(a[6]=t("div",{class:"badge-icon"},"ðŸ›¡ï¸",-1)),t("span",null,i(e.$t("auth.privacyProtection")),1)]),t("div",le,[a[7]||(a[7]=t("div",{class:"badge-icon"},"âš¡",-1)),t("span",null,i(e.$t("auth.unlimitedTraffic")),1)])])])]),t("div",ie,[t("div",ne,[t("div",de,[t("h2",null,i(e.$t("auth.registerButton")),1),t("p",null,i(e.$t("auth.registerSubtitle")),1)]),r(P,{model:s,onFinish:A,layout:"vertical"},{default:u(()=>[r(l,{label:e.$t("auth.email"),name:"email",rules:[{validator:q}]},{default:u(()=>[r(c,{value:s.email,"onUpdate:value":a[0]||(a[0]=d=>s.email=d),placeholder:"your@email.com",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),p.value.is_email_verify?(v(),N(l,{key:0,label:"é‚®ç®±éªŒè¯ç ",name:"email_code",rules:[{required:!0,message:"è¯·è¾“å…¥é‚®ç®±éªŒè¯ç "}],class:"code-item"},{default:u(()=>[t("div",ue,[r(c,{value:s.email_code,"onUpdate:value":a[1]||(a[1]=d=>s.email_code=d),placeholder:"è¾“å…¥éªŒè¯ç ",size:"large"},null,8,["value"]),r(o,{type:"primary",class:"send-code-btn",disabled:h.value>0||!s.email,onClick:U},{default:u(()=>[S(i(h.value>0?`${h.value}s`:"å‘é€éªŒè¯ç "),1)]),_:1},8,["disabled"])])]),_:1})):R("",!0),r(l,{label:e.$t("auth.password"),name:"password",rules:[{required:!0,message:e.$t("validation.passwordRequired")}]},{default:u(()=>[r(I,{value:s.password,"onUpdate:value":a[2]||(a[2]=d=>s.password=d),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),r(l,{label:e.$t("auth.confirmPassword"),name:"re_password",rules:[{required:!0,message:e.$t("validation.passwordRequired")}]},{default:u(()=>[r(I,{value:s.re_password,"onUpdate:value":a[3]||(a[3]=d=>s.re_password=d),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),_(f).enableCaptcha?(v(),N(K,{key:1,onVerify:E})):R("",!0),r(l,{name:"agreement",rules:[{validator:V}]},{default:u(()=>[r(B,{checked:s.agreement,"onUpdate:checked":a[4]||(a[4]=d=>s.agreement=d)},{default:u(()=>[S(i(e.$t("auth.agreement")),1)]),_:1},8,["checked"])]),_:1},8,["rules"]),r(o,{type:"primary","html-type":"submit",loading:y.value,block:"",size:"large"},{default:u(()=>[S(i(e.$t("auth.registerButton")),1)]),_:1},8,["loading"])]),_:1},8,["model"]),t("div",ce,[t("span",null,i(e.$t("auth.hasAccount")),1),t("a",me,i(e.$t("auth.backToLogin")),1)])])])])])}}},be=Q(fe,[["__scopeId","data-v-1ee47c15"]]);export{be as default};
